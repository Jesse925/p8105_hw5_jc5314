P8105 Homework 5
================
Junxian Chen (jc5314)
11/2/2019

# Problem 1

``` r
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

Firstly, load the dataset with missing values.

``` r
replaceNA = function(x){
  
  if (class(x) == "numeric") {
    replace_na(x, mean(x, na.rm = TRUE))
  } else if (class(x) == "character") {
    replace_na(x, "virginica") 
  } else {
    stop("Input is neither numeric nor character")
  }

}
```

Next, a function called `replaceNA` is created. This function will take
a vector as an argument, detect the input variable type and then replace
missing values using the rules defined in the question. If the input
value is neither numeric nor character, the function will stop and give
out error information.

Lastly, apply this function to the columns of dataset using a map
statement.

``` r
output = map_df(iris_with_missing, replaceNA)

output
```

    ## # A tibble: 150 x 5
    ##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
    ##           <dbl>       <dbl>        <dbl>       <dbl> <chr>  
    ##  1         5.1          3.5         1.4         0.2  setosa 
    ##  2         4.9          3           1.4         0.2  setosa 
    ##  3         4.7          3.2         1.3         0.2  setosa 
    ##  4         4.6          3.1         1.5         1.19 setosa 
    ##  5         5            3.6         1.4         0.2  setosa 
    ##  6         5.4          3.9         1.7         0.4  setosa 
    ##  7         5.82         3.4         1.4         0.3  setosa 
    ##  8         5            3.4         1.5         0.2  setosa 
    ##  9         4.4          2.9         1.4         0.2  setosa 
    ## 10         4.9          3.1         3.77        0.1  setosa 
    ## # … with 140 more rows

# Problem 2

Read in and tidy the datasets:

``` r
p2_df =
  tibble(
    file_name = list.files(path = './data', full.names = TRUE),
    data = map(file_name, ~read_csv(.)),
    group = case_when(
      file_name %>% str_detect("con") ~ "control",
      file_name %>% str_detect("exp") ~ "experiment",
    ),
    id = as.numeric(str_extract_all(file_name, "[0-9]+"))
  ) %>% 
  unnest(cols = c(data)) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "data"
  ) %>% 
  mutate(
    full_id = paste(group, "_", as.character(id), sep = ""),
    week = as.numeric(str_extract_all(week, "[0-9]+"))
  ) %>% 
  select(full_id, group, id, week, data)

p2_df
```

    ## # A tibble: 160 x 5
    ##    full_id   group      id  week  data
    ##    <chr>     <chr>   <dbl> <dbl> <dbl>
    ##  1 control_1 control     1     1  0.2 
    ##  2 control_1 control     1     2 -1.31
    ##  3 control_1 control     1     3  0.66
    ##  4 control_1 control     1     4  1.96
    ##  5 control_1 control     1     5  0.23
    ##  6 control_1 control     1     6  1.09
    ##  7 control_1 control     1     7  0.05
    ##  8 control_1 control     1     8  1.94
    ##  9 control_2 control     2     1  1.13
    ## 10 control_2 control     2     2 -0.88
    ## # … with 150 more rows

A spaghetti plot showing observations on each subject over time:

``` r
p2_df %>% 
  ggplot(aes(x = week, y = data, group = full_id, color = group)) +
  geom_line() +
  xlab("Week") +
  ylab("Data")
```

<img src="p8105_hw5_jc5314_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />

*Comments:* The data values of the experiment group were increasing
along with time and the overall data values in experiment group were
distinctly larger than the control group after 6 weeks.

# Problem 3

``` r
generate_xy = function(beta_1, n, beta_0, sigma){
  sim_data = tibble(
    x = rnorm(n),
    y = beta_0 + beta_1 * x + rnorm(n, 0, sigma)
  )
  return(sim_data)
}
```

``` r
generate_df = function(beta_1, generate_xy, n = 30, beta_0 = 2, sigma = sqrt(50)){
  
  tibble(
    truth = beta_1,
    data = rerun(10, generate_xy(beta_1, n, beta_0, sigma)),
    model = map(data, ~ broom::tidy(lm(y ~ x, data = .))),
    estimate = map(model, ~ .x[2,2]),
    p_value = map(model, ~ .x[2,5])
  )  %>% 
  unnest(estimate:p_value) %>% 
  select(-model, p_value = p.value)
  
}
```

``` r
set.seed(1)

df_1 = generate_df(beta_1 = 0, generate_xy)
```

``` r
beta_1 = list(1, 2, 3, 4, 5, 6)

df_2 = 
  map(beta_1, ~ generate_df(.x, generate_xy)) %>% 
  bind_rows()
```

  - A plot showing the proportion of times the null was rejected (the
    power of the test) on the \(y\) axis and the true value of
    \(\beta_1\) on the \(x\) axis.

<!-- end list -->

``` r
df_2 %>% 
  group_by(truth) %>% 
  mutate(
    reject_prop = sum(p_value < 0.05) / length(p_value)
  ) %>% 
  ggplot(aes(x = truth, y = reject_prop, fill = truth)) +
  geom_col() + 
  xlab("True Value of Beta_1") +
  ylab("Proportion of times the null was rejected") +
  scale_x_continuous(
    breaks = c(1, 2, 3, 4, 5, 6)
  )
```

<img src="p8105_hw5_jc5314_files/figure-gfm/unnamed-chunk-11-1.png" width="90%" />

*Comments: Describe the association between effect size and power.*

  - Make a plot showing the average estimate of \(\hat{\beta_1}\) on the
    \(y\) axis and the true value of \(\beta_1\) on the \(x\) axis.

<!-- end list -->

``` r
df_2 %>% 
  group_by(truth) %>% 
  summarize(mean_estimator = mean(estimate)) %>% 
  ggplot(aes(x = truth, y = mean_estimator, fill = truth)) +
  geom_col() + 
  xlab("True Value of Beta_1") +
  ylab("Average estimate of Beta_1") +
  scale_x_continuous(
    breaks = c(1, 2, 3, 4, 5, 6)
  )
```

<img src="p8105_hw5_jc5314_files/figure-gfm/unnamed-chunk-12-1.png" width="90%" />

``` r
df_2 %>% 
  filter(p_value < 0.05) %>% 
  group_by(truth) %>% 
  summarize(mean_estimator = mean(estimate)) %>% 
  ggplot(aes(x = truth, y = mean_estimator, fill = truth)) +
  geom_col() + 
  xlab("True Value of Beta_1") +
  ylab("Average estimate of Beta_1") +
  scale_x_continuous(
    breaks = c(1, 2, 3, 4, 5, 6)
  )
```

<img src="p8105_hw5_jc5314_files/figure-gfm/unnamed-chunk-13-1.png" width="90%" />
